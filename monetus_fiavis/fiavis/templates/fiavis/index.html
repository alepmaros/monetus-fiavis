<script>
    var all_days = {{ all_days | safe }}
    var all_stocks = {{ all_stocks | safe }}
    console.log(all_days)
</script>

<h1>Oi {{ last_day_updated.vcp }}</h1>

<table>
    <tr>
        <th>Código</th>
        <th>Porcentagem fundo</th>
        <th>Valorizacao</th>
    </tr>
    {% for stockinst in last_stocks_updated  %}
    <tr>
        <td>{{ stockinst.code }}</td>
        <td>{{ stockinst.fshare }}</td>
        <td>{{ stockinst.vcp }}</td>
    </tr>
    {% endfor %}
</table>

Ultima vez atualizado há {{ last_day_updated.time | timesince }}


<!-- Styles -->
<style>
    #chartdiv {
      width: 100%;
      height: 500px;
    }
    </style>
    
    <!-- Resources -->
    <script src="https://www.amcharts.com/lib/3/amcharts.js"></script>
    <script src="https://www.amcharts.com/lib/3/serial.js"></script>
    <script src="https://www.amcharts.com/lib/3/amstock.js"></script>
    <script src="https://www.amcharts.com/lib/3/plugins/export/export.min.js"></script>
    <link rel="stylesheet" href="https://www.amcharts.com/lib/3/plugins/export/export.css" type="text/css" media="all" />
    <script src="https://www.amcharts.com/lib/3/themes/light.js"></script>
    
    <!-- Chart code -->
    <script>
    var fiaData = [];

    all_days.forEach(element => {
        console.log(typeof new Date(element.fields.time))
        d = new Date(element.fields.time)
        d.setHours(0,0,0,0)
        fiaData.push({
            "date": d,
            "value": element.fields.vcp
        });
    });

    fiaData = fiaData.reverse();

    
    var chart = AmCharts.makeChart( "chartdiv", {
      "type": "stock",
      "theme": "light",
      "dataSets": [ {
          "title": "Monetus FIA",
          "fieldMappings": [ {
            "fromField": "value",
            "toField": "value"
          }, {
            "fromField": "volume",
            "toField": "volume"
          } ],
          "dataProvider": fiaData,
          "categoryField": "date"
        }
      ],
    
      "panels": [ {
        "showCategoryAxis": false,
        "title": "Value",
        "percentHeight": 70,
        "stockGraphs": [ {
          "id": "g1",
          "valueField": "value",
          "comparable": true,
          "compareField": "value",
          "balloonText": "[[title]]:<b>[[value]]</b>",
          "compareGraphBalloonText": "[[title]]:<b>[[value]]</b>"
        } ],
        "stockLegend": {
          "periodValueTextComparing": "[[percents.value.close]]%",
          "periodValueTextRegular": "[[value.close]]"
        }
      }, {
        "title": "Volume",
        "percentHeight": 30,
        "stockGraphs": [ {
          "valueField": "volume",
          "type": "column",
          "showBalloon": false,
          "fillAlphas": 1
        } ],
        "stockLegend": {
          "periodValueTextRegular": "[[value.close]]"
        }
      } ],
    
      "chartScrollbarSettings": {
        "graph": "g1"
      },
    
      "chartCursorSettings": {
        "valueBalloonsEnabled": true,
        "fullWidth": true,
        "cursorAlpha": 0.1,
        "valueLineBalloonEnabled": true,
        "valueLineEnabled": true,
        "valueLineAlpha": 0.5
      },
    
      "periodSelector": {
        "position": "left",
        "periods": [ {
          "period": "MM",
          "selected": true,
          "count": 1,
          "label": "1 month"
        }, {
          "period": "YYYY",
          "count": 1,
          "label": "1 year"
        }, {
          "period": "YTD",
          "label": "YTD"
        }, {
          "period": "MAX",
          "label": "MAX"
        } ]
      },
    
      "dataSetSelector": {
        "position": "left"
      },
    
      "export": {
        "enabled": true
      }
    } );
    </script>
    
    <!-- HTML -->
    <div id="chartdiv"></div>